!function(t,e){"use strict";"undefined"!=typeof module&&module.exports?(e("undefined"==typeof angular?require("angular"):angular),module.exports="angular-brew-analytics"):"function"==typeof define&&define.amd?define(["angular"],e):e(t.angular)}(this,function(t,e){"use strict";return t.module("angular-brew-analytics",[]).provider("Analytics",function(){var n,r,i,a,c,o={UI_ROUTER:"ui",NG_ROUTER:"ng"},s=!1,u=!1,l=!1,f="USD",d=!1,p=!1,h=!1,g=!1,k=!1,m=!1,_=!1,b=!1,y=!1,T=!1,E=!1,v="$routeChangeSuccess",w=!1,R=!1,U=!1,P="",I=!0,A=!1,S=o.NG_ROUTER,C="",$=!0,D=30;this.log=[],this.offlineQueue=[],this.setAccount=function(r){return n=t.isUndefined(r)||r===!1?e:t.isArray(r)?r:t.isObject(r)?[r]:[{tracker:r,trackEvent:!0}],this},this.trackPages=function(t){return I=!!t,this},this.trackPrefix=function(t){return P=t,this},this.setDomainName=function(t){return i=t,this},this.useDisplayFeatures=function(t){return h=!!t,this},this.useEnhancedLinkAttribution=function(t){return _=!!t,this},this.useCrossDomainLinker=function(t){return l=!!t,this},this.setCrossLinkDomains=function(t){return r=t,this},this.setPageEvent=function(t){return v=t,this},this.useECommerce=function(t,e){return k=!!t,m=!!e,this},this.setCurrency=function(t){return f=t,this},this.setRemoveRegExp=function(t){return t instanceof RegExp&&(c=t),this},this.setExperimentId=function(t){return a=t,this},this.ignoreFirstPageLoad=function(t){return b=!!t,this},this.trackUrlParams=function(t){return A=!!t,this},this.disableAnalytics=function(t){return g=!!t,this},this.setHybridMobileSupport=function(t){return T=!!t,this},this.startOffline=function(t){return E=!!t,E===!0&&this.delayScriptTag(!0),this},this.delayScriptTag=function(t){return p=!!t,this},this.logAllCalls=function(t){return y=!!t,this},this.enterTestMode=function(){return R=!0,this},this.enterDebugMode=function(t){return d=!0,U=!!t,this},this.readFromRoute=function(t){return w=!!t,this},this.enableLinkTracking=function(t){return $=!!t,this},this.enableHeartBeatTimer=function(t){return D=t?t:15,this},this.setUserId=function(t){return C=t,this},this.$get=["$document","$location","$log","$rootScope","$window","$injector",function(e,N,L,O,x,j){function B(t){for(var e in t)return!1;return!0}var M=this,F=function(t){var e=t.has("$urlRouter")?o.UI_ROUTER:o.NG_ROUTER;return e},H={};if(w){switch(S=F(j)){case o.UI_ROUTER:H=j.get("$urlRouter");break;case o.NG_ROUTER:H=j.get("$route")}B(H)&&L.warn("No route service is available. Make sure you have included ngRoute or ui.router in your application dependencies.")}var Q=function(){if(w&&H.current&&"baPageTrack"in H.current)return H.current.baPageTrack;var t=A?N.url():N.path();return c?t.replace(c,""):t},G=function(){return w&&H.current&&"baPageTitle"in H.current?H.current.baPageTitle:e[0].title},V=function(e,n){var r="",i="https:"===document.location.protocol,a="chrome-extension:"===document.location.protocol,c=s===!0&&T===!0;return e=t.isString(e)?e:"",n=t.isString(n)?n:"",""!==e&&(r="http:"+e),(a||c||i&&""!==n)&&(r="https:"+n),r},q=function(t){!s&&x._brew&&"function"==typeof t&&t()},z=function(){var t=Array.prototype.slice.call(arguments);return E===!0?void M.offlineQueue.push([z,t]):(x._brew||(x._brew=[]),y===!0&&M._log.apply(M,t),void x._brew.push(t))};if(this._log=function(){var t=Array.prototype.slice.call(arguments);if(t.length>0){if(t.length>1)switch(t[0]){case"debug":case"error":case"info":case"log":case"warn":L[t[0]](t.slice(1))}M.log.push(t)}},this._registerScriptTags=function(){var t,r=e[0];V();return u===!0?void M._log("warn","Script tags already created"):(g===!0&&n.forEach(function(t){M._log("info","Brew Analytics disabled: "+t.tracker),x["ba-disable-"+t.tracker]=!0}),s===!0||(1!=R?!function(t,e,n,r,i,a,c,o){t.BrewAnalyticsObject=a,t.brewNewStyle=!0,z("setTrackerUrl",r+i+".php"),c=e.createElement(n),o=e.getElementsByTagName(n)[0],c.src=r+i+".js?v=a6",o.parentNode.insertBefore(c,o)}(window,r,"script","domainName","brewanalytics","brew"):M._log("inject",t)),u=!0,!0)},this._registerTrackers=function(){return!n||n.length<1?void M._log("warn","No accounts to register"):(n.length>1&&(M._log("warn","Multiple trackers are not supported with brewanalytics.js. Using first tracker only"),n=n.slice(0,1)),M._enableLinkTracking($),M._enableHeartBeatTimer(D),z("setSiteId",n[0].tracker),I&&!b&&(c?M._trackPage(Q()):M._trackPage()),!0)},this._ecommerceEnabled=function(t,e){var n=k&&!m;return t===!0&&n===!1&&(k&&m?M._log("warn",e+" is not available when Enhanced Ecommerce is enabled with brewanalytics.js"):M._log("warn","Ecommerce must be enabled to use "+e+" with brewanalytics.js")),n},this._enhancedEcommerceEnabled=function(t,e){var n=k&&m;return t===!0&&n===!1&&M._log("warn","Enhanced Ecommerce must be enabled to use "+e+" with brewanalytics.js"),n},this._enableLinkTracking=function(t){t=!!t&&t,q(function(){z("enableLinkTracking",t)})},this._enableHeartBeatTimer=function(t){t=t?t:30,q(function(){z("enableHeartBeatTimer",t)})},this._trackPage=function(t,e,n){t=t?t:Q(),e=e?e:G(),q(function(){z("setDocumentTitle",e),z("setCustomUrl",P+t),z("trackPageView")})},this._trackEvent=function(t,e,n,r){q(function(){z("trackEvent",t,e,n,r)})},this._addTrans=function(t,e,n,r,i,a,c,o,s){q(function(){z("_addTrans",t,e,n,r,i,a,c,o)})},this._addItem=function(t,e,n,r,i,a){q(function(){z("_addItem",t,e,n,r,i,a)})},this._trackTrans=function(){q(function(){z("_trackTrans")})},this._clearTrans=function(){},this._addProduct=function(t,e,n,r,i,a,c,o,s,u){q(function(){z("_addProduct",t,e,n,r,i,a,c,o,s)})},this._setUserId=function(t){q(function(){z("setUserId",t)})},p||(this._registerScriptTags(),this._registerTrackers()),I)switch(S){case o.UI_ROUTER:O.$on(v,function(t,e,n,r,i){w&&(H.current=e,!H.current||!H.current.templateUrl||H.current.baDoNotTrack)||M._trackPage()});break;case o.NG_ROUTER:O.$on(v,function(t,e,n){(!w||H.current&&H.current.templateUrl&&!H.current.baDoNotTrack)&&M._trackPage()})}return{log:M.log,offlineQueue:M.offlineQueue,configuration:{accounts:n,universalAnalytics:s,crossDomainLinker:l,crossLinkDomains:r,currency:f,debugMode:d,delayScriptTag:p,disableAnalytics:g,displayFeatures:h,domainName:i,ecommerce:M._ecommerceEnabled(),enhancedEcommerce:M._enhancedEcommerceEnabled(),enhancedLinkAttribution:_,experimentId:a,hybridMobileSupport:T,ignoreFirstPageLoad:b,logAllCalls:y,pageEvent:v,readFromRoute:w,removeRegExp:c,testMode:R,traceDebuggingMode:U,trackPrefix:P,trackRoutes:I,trackUrlParams:A,routerType:S,userId:C,enableLinkTracking:$,enableHeartBeatTimer:D},getUrl:Q,getTitle:G,registerScriptTags:function(){return M._registerScriptTags()},registerTrackers:function(){return M._registerTrackers()},offline:function(t){if(t===!0&&E===!1&&(E=!0),t===!1&&E===!0)for(E=!1;M.offlineQueue.length>0;){var e=M.offlineQueue.shift();e[0].apply(M,e[1])}return E},trackPage:function(t,e,n){M._trackPage.apply(M,arguments)},trackEvent:function(t,e,n,r,i,a){M._trackEvent.apply(M,arguments)},addTrans:function(t,e,n,r,i,a,c,o,s){M._addTrans.apply(M,arguments)},addItem:function(t,e,n,r,i,a){M._addItem.apply(M,arguments)},trackTrans:function(){M._trackTrans.apply(M,arguments)},clearTrans:function(){M._clearTrans.apply(M,arguments)},addProduct:function(t,e,n,r,i,a,c,o,s,u){M._addProduct.apply(M,arguments)},addPromo:function(t,e,n,r){M._addPromo.apply(M,arguments)},addImpression:function(t,e,n,r,i,a,c,o){M._addImpression.apply(M,arguments)},productClick:function(t){M._productClick.apply(M,arguments)},promoClick:function(t){M._promoClick.apply(M,arguments)},trackDetail:function(){M._trackDetail.apply(M,arguments)},trackCart:function(t,e){M._trackCart.apply(M,arguments)},trackCheckout:function(t,e){M._trackCheckOut.apply(M,arguments)},trackTimings:function(t,e,n,r){M._trackTimings.apply(M,arguments)},trackTransaction:function(t,e,n,r,i,a,c,o,s){M._trackTransaction.apply(M,arguments)},trackException:function(t,e){M._trackException.apply(M,arguments)},setAction:function(t,e){M._setAction.apply(M,arguments)},pageView:function(){M._pageView.apply(M,arguments)},setUserId:function(){M._setUserId.apply(M,arguments)}}}]}).directive("baTrackEvent",["Analytics","$parse",function(t,e){return{restrict:"A",link:function(n,r,i){var a=e(i.baTrackEvent);r.bind("click",function(){i.baTrackEventIf&&!n.$eval(i.baTrackEventIf)||a.length>1&&t.trackEvent.apply(t,a(n))})}}}]),t.module("angular-brew-analytics")});
